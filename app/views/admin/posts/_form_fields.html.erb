<% if @post.errors.any? %>
	<div class="alert alert-danger">
		<p>Oops! Something went wrong. Try again!</p>
		<ul>
	  	<% @post.errors.full_messages.each do |msg| %>
		    <li><%= msg %></li>
		  <% end %>
		</ul>
	</div>
<% end %>

<div class="form-group">
	<%= f.label :title %>
	<%= f.text_field :title, class: 'form-control' %>
</div>

<div class="form-group">
	<%= f.label :excerpt %>
	<%= f.text_area :excerpt, class: 'form-control' %>
</div>

<div class="form-group">
	<%= f.label :tag_tokens, "Tags" %>
	<%= f.text_field :tag_tokens, class: 'form-control', data: { provider: 'tokeninput', load: @post.tags } %>
</div>

<div class="form-group">
	<%= f.label :content, "Primary content" %>
	<%= f.text_area :content, class: 'form-control', data: { provider: 'summernote'} %>
</div>

<div class="form-group">
	<%= label_tag :featured_images %>
	<div class="image_attachments sortable">
		<%= f.fields_for :image_attachments do |builder| %>
			<%= render 'image_attachment_fields', f: builder %>
		<% end %>
		<%= link_to_add_fields "Add image", f, :image_attachments, {:class => 'add_image add_fields_here btn btn-default'} %>
	</div>
	<div class="clearfix"></div>
</div>

<hr>

<div class="sortable">
	<%= f.fields_for :content_blocks do |builder| %>
		<%= render "#{builder.object.class.name.underscore}_fields", f: builder %>
	<% end %>

	<div class="add_fields_here">
		<%= link_to_add_fields '<i class="fa fa-fw icon-image"></i> Add image block'.html_safe, f, :image_blocks, { class: 'btn btn-default' } %>
		<%= link_to_add_fields '<i class="fa fa-fw icon-text"></i> Add text block'.html_safe, f, :text_blocks, { class: 'btn btn-default' } %>
		<%= link_to_add_fields '<i class="fa fa-fw icon-images"></i> Add image slider block'.html_safe, f, :image_slider_blocks, { class: 'btn btn-default' } %>
		<%= link_to_add_fields '<i class="fa fa-fw icon-video"></i> Add video block'.html_safe, f, :video_blocks, { class: 'btn btn-default' } %>
	</div>
</div>

<hr>

<% if @post.publish_at.present? && @post.publish_at < DateTime.now  %>
	<div class="checkbox">
		<%= label_tag do %>
			<%= f.check_box :published, id: "published" %> Publish
		<% end %>
	</div>
<% end %>
<div class="checkbox">
	<% should_be_checked = (@post.publish_at.nil? || @post.publish_at < DateTime.now) ? false : true %>
	<%= label_tag do %>
		<%= check_box_tag :schedule_post, nil, should_be_checked, id: "schedule_post" %> Schedule
	<% end %>
</div>
<div class="row" id="publish_at_form_group">
	<div class="form-group col-md-4">
		<div class="input-group">
			<%= f.datetime_field :publish_at, value: (@post.publish_at.blank? ? '' : @post.publish_at.to_s(:formatted)), class: "form-control datetimepicker" %>	
			<span class="input-group-addon"><i class="fa fa-calendar"></i></span>
		</div>
	</div>
</div>

<div class="form-group">
	<%= f.submit "Save", class: "btn btn-default" %>
	<%= f.submit "Schedule", class: "btn btn-primary" %>
	<%= f.submit "Publish now", class: "btn btn-primary" unless (@post.published? && @post.publish_at && @post.publish_at < DateTime.now) %>
</div>